{% extends "base.html" %} {% block title %}Danh sách ca điểm danh{% endblock %} {% block head %}
<style>
  .session-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    margin-bottom: 20px;
  }

  .session-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
  }

  .session-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0;
    padding: 20px;
  }

  .session-body {
    padding: 20px;
  }

  .status-badge {
    font-size: 0.85em;
    padding: 5px 12px;
    border-radius: 20px;
  }

  .status-active {
    background: #d4edda;
    color: #155724;
  }

  .status-completed {
    background: #cce5ff;
    color: #004085;
  }

  .stats-item {
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    background: #f8f9fa;
    margin: 5px;
  }

  .filter-buttons {
    margin-bottom: 30px;
  }

  .filter-btn {
    margin-right: 10px;
    margin-bottom: 10px;
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
          <i class="fas fa-calendar-check me-2"></i>
          Danh sách ca điểm danh
        </h2>
        <a href="{{ url_for('attendance.add_session') }}" class="btn btn-primary">
          <i class="fas fa-plus me-1"></i>
          Tạo ca mới
        </a>
      </div>
    </div>
  </div>

  <!-- Filter Buttons -->
  <div class="filter-buttons">
    <button class="btn btn-outline-primary filter-btn active" data-filter="all">
      <i class="fas fa-list me-1"></i>
      Tất cả
    </button>
    <button class="btn btn-outline-success filter-btn" data-filter="today">
      <i class="fas fa-calendar-day me-1"></i>
      Hôm nay
    </button>
    <button class="btn btn-outline-info filter-btn" data-filter="this-week">
      <i class="fas fa-calendar-week me-1"></i>
      Tuần này
    </button>
    <button class="btn btn-outline-warning filter-btn" data-filter="active">
      <i class="fas fa-play me-1"></i>
      Đang hoạt động
    </button>
  </div>

  {% if sessions %}
  <div class="row" id="sessionsContainer">
    {% for session in sessions %}
    <div class="col-lg-6 col-xl-4 session-item" data-date="{{ session.session_date }}" data-status="{{ session.status or 'active' }}">
      <div class="session-card">
        <div class="session-header">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="mb-1">{{ session.session_name }}</h5>
              <p class="mb-0 opacity-75">
                <i class="fas fa-book me-2"></i>
                {{ session.subject_name }}
              </p>
            </div>
            <span class="status-badge status-{{ session.status or 'active' }}"> {{ 'Hoạt động' if (session.status or 'active') == 'active' else 'Hoàn thành' }} </span>
          </div>
        </div>

        <div class="session-body">
          <div class="row mb-3">
            <div class="col-12">
              <p class="mb-2">
                <i class="fas fa-users me-2 text-primary"></i>
                <strong>Lớp:</strong> {{ session.class_name }} ({{ session.class_code }})
              </p>
              <p class="mb-2">
                <i class="fas fa-calendar me-2 text-success"></i>
                <strong>Ngày:</strong> {{ session.session_date }}
              </p>
              <p class="mb-0">
                <i class="fas fa-clock me-2 text-warning"></i>
                <strong>Thời gian:</strong>
                {{ session.start_time }} {% if session.end_time %} - {{ session.end_time }}{% endif %}
              </p>
            </div>
          </div>

          <!-- Statistics -->
          <div class="row">
            <div class="col-6">
              <div class="stats-item">
                <div class="fw-bold text-primary">{{ session.attendance_count or 0 }}</div>
                <small class="text-muted">Đã điểm danh</small>
              </div>
            </div>
            <div class="col-6">
              <div class="stats-item">
                <div class="fw-bold text-info">{{ session.subject_code }}</div>
                <small class="text-muted">Mã môn</small>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="mt-3 d-flex gap-2">
            <a href="{{ url_for('attendance.session_detail', session_id=session.id) }}" class="btn btn-outline-primary btn-sm flex-fill">
              <i class="fas fa-eye me-1"></i>
              Chi tiết
            </a>

            <a href="{{ url_for('attendance.face_recognition_page', session_id=session.id) }}" class="btn btn-success btn-sm flex-fill">
              <i class="fas fa-camera me-1"></i>
              Điểm danh
            </a>

            <form method="POST" action="{{ url_for('attendance.delete_session', session_id=session.id) }}" class="d-inline" onsubmit="return confirm('Bạn có chắc muốn xóa ca điểm danh này?')">
              <button type="submit" class="btn btn-outline-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5">
    <i class="fas fa-calendar-times fa-5x text-muted mb-3"></i>
    <h4 class="text-muted">Chưa có ca điểm danh nào</h4>
    <p class="text-muted mb-4">Tạo ca điểm danh đầu tiên để bắt đầu sử dụng hệ thống</p>
    <a href="{{ url_for('attendance.add_session') }}" class="btn btn-primary btn-lg">
      <i class="fas fa-plus me-2"></i>
      Tạo ca điểm danh mới
    </a>
  </div>
  {% endif %}
</div>

<script>
  // Filter functionality
  document.querySelectorAll(".filter-btn").forEach((btn) => {
    btn.addEventListener("click", function () {
      // Update active button
      document.querySelectorAll(".filter-btn").forEach((b) => b.classList.remove("active"));
      this.classList.add("active");

      const filter = this.dataset.filter;
      const sessions = document.querySelectorAll(".session-item");
      const today = new Date().toISOString().split("T")[0];
      const thisWeekStart = new Date();
      thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
      const thisWeekEnd = new Date(thisWeekStart);
      thisWeekEnd.setDate(thisWeekStart.getDate() + 6);

      sessions.forEach((session) => {
        const sessionDate = session.dataset.date;
        const sessionStatus = session.dataset.status;
        let show = true;

        switch (filter) {
          case "today":
            show = sessionDate === today;
            break;
          case "this-week":
            const sessionDateObj = new Date(sessionDate);
            show = sessionDateObj >= thisWeekStart && sessionDateObj <= thisWeekEnd;
            break;
          case "active":
            show = sessionStatus === "active";
            break;
          case "all":
          default:
            show = true;
            break;
        }

        session.style.display = show ? "block" : "none";
      });
    });
  });
</script>
{% endblock %}
