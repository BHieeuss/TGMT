# üîÑ Lu·ªìng Ho·∫°t ƒë·ªông H·ªá th·ªëng ƒêi·ªÉm danh Khu√¥n m·∫∑t

**H·ªá th·ªëng:** ƒêi·ªÉm danh Sinh vi√™n b·∫±ng AI Face Recognition  
**Framework:** Python Flask + SQLite + OpenCV  
**Ng√†y c·∫≠p nh·∫≠t:** 03/07/2025

## üìã M·ª•c l·ª•c

- [Lu·ªìng K·ªπ thu·∫≠t](#lu·ªìng-k·ªπ-thu·∫≠t)
- [Lu·ªìng Ng∆∞·ªùi d√πng](#lu·ªìng-ng∆∞·ªùi-d√πng)
- [Architecture Overview](#architecture-overview)
- [Database Flow](#database-flow)
- [Authentication Flow](#authentication-flow)
- [Face Recognition Pipeline](#face-recognition-pipeline)
- [Performance Metrics](#performance-metrics)
- [Error Handling](#error-handling)
- [System Monitoring](#system-monitoring)

---

## üèóÔ∏è Lu·ªìng K·ªπ thu·∫≠t

### üéØ Architecture Overview

```mermaid
graph TB
    subgraph "Client Layer"
        UI[Web Browser]
        CAM[Camera/Webcam]
    end
    
    subgraph "Flask Application"
        APP[app.py - Main Flask App]
        AUTH[auth.py - Authentication]
        ROUTES[Route Blueprints]
    end
    
    subgraph "AI Processing"
        FACE[Face Recognition AI]
        CV[OpenCV Processing]
        MODEL[ML Models]
    end
    
    subgraph "Data Layer"
        DB[SQLite Database]
        FILES[File Storage]
        EXPORT[Excel Export]
    end
    
    UI --> APP
    CAM --> FACE
    APP --> AUTH
    APP --> ROUTES
    ROUTES --> FACE
    FACE --> CV
    CV --> MODEL
    ROUTES --> DB
    ROUTES --> FILES
    DB --> EXPORT
    
    style APP fill:#e1f5fe
    style FACE fill:#f3e5f5
    style DB fill:#e8f5e8
```

### üîÑ System Initialization Flow

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant Flask
    participant Database
    participant AI_Module
    
    User->>Browser: Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
    Browser->>Flask: Request to localhost:5000
    Flask->>Database: Ki·ªÉm tra connection
    Flask->>AI_Module: Load ML models
    AI_Module-->>Flask: Models ready
    Database-->>Flask: DB ready
    Flask-->>Browser: Redirect to /login
    Browser-->>User: Hi·ªÉn th·ªã trang login
```

---

## üë§ Lu·ªìng Ng∆∞·ªùi d√πng

### üö™ User Journey - To√†n b·ªô quy tr√¨nh

```mermaid
journey
    title H√†nh tr√¨nh Ng∆∞·ªùi d√πng trong H·ªá th·ªëng
    section ƒêƒÉng nh·∫≠p
      Truy c·∫≠p website: 5: User
      Nh·∫≠p username/password: 4: User
      X√°c th·ª±c th√†nh c√¥ng: 5: User, System
    section Qu·∫£n l√Ω D·ªØ li·ªáu
      T·∫°o l·ªõp h·ªçc: 4: User
      Th√™m sinh vi√™n: 4: User
      Thu th·∫≠p d·ªØ li·ªáu khu√¥n m·∫∑t: 3: User, System
      T·∫°o m√¥n h·ªçc: 4: User
    section ƒêi·ªÉm danh
      T·∫°o ca ƒëi·ªÉm danh: 4: User
      Ch·ªçn thu·∫≠t to√°n AI: 4: User
      B·∫Øt ƒë·∫ßu nh·∫≠n di·ªán: 5: System
      Xem k·∫øt qu·∫£: 5: User, System
    section B√°o c√°o
      Ch·ªçn l·ªõp/m√¥n h·ªçc: 4: User
      Xu·∫•t Excel: 5: System
      T·∫£i file b√°o c√°o: 5: User
```

### üéØ Main User Workflows

```mermaid
flowchart TD
    START([Kh·ªüi ƒë·ªông H·ªá th·ªëng]) --> LOGIN{ƒê√£ ƒëƒÉng nh·∫≠p?}
    LOGIN -->|Ch∆∞a| AUTH[Trang ƒêƒÉng nh·∫≠p]
    LOGIN -->|R·ªìi| DASH[Dashboard]
    
    AUTH --> CHECK{Credentials?}
    CHECK -->|Sai| AUTH
    CHECK -->|ƒê√∫ng| DASH
    
    DASH --> MGMT[Qu·∫£n l√Ω D·ªØ li·ªáu]
    DASH --> ATTEND[ƒêi·ªÉm danh]
    DASH --> REPORT[B√°o c√°o]
    DASH --> AI_SET[C√†i ƒë·∫∑t AI]
    
    subgraph "Qu·∫£n l√Ω D·ªØ li·ªáu"
        MGMT --> CLASS[Qu·∫£n l√Ω L·ªõp]
        MGMT --> STUDENT[Qu·∫£n l√Ω Sinh vi√™n]
        MGMT --> SUBJECT[Qu·∫£n l√Ω M√¥n h·ªçc]
        STUDENT --> COLLECT[Thu th·∫≠p Khu√¥n m·∫∑t]
    end
    
    subgraph "ƒêi·ªÉm danh"
        ATTEND --> CREATE_SESSION[T·∫°o Ca ƒëi·ªÉm danh]
        CREATE_SESSION --> SELECT_AI[Ch·ªçn Thu·∫≠t to√°n]
        SELECT_AI --> START_CAM[B·∫≠t Camera]
        START_CAM --> RECOGNIZE[Nh·∫≠n di·ªán]
        RECOGNIZE --> SAVE_RESULT[L∆∞u K·∫øt qu·∫£]
    end
    
    subgraph "B√°o c√°o"
        REPORT --> SELECT_CLASS[Ch·ªçn L·ªõp]
        SELECT_CLASS --> SELECT_SUBJECT[Ch·ªçn M√¥n]
        SELECT_SUBJECT --> EXPORT[Xu·∫•t Excel]
    end
    
    style DASH fill:#e3f2fd
    style RECOGNIZE fill:#f3e5f5
    style EXPORT fill:#e8f5e8
```

---

## üîê Authentication Flow

### üõ°Ô∏è Security v√† Session Management

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant Flask
    participant Session
    participant Database
    
    User->>Browser: Nh·∫≠p URL b·∫•t k·ª≥
    Browser->>Flask: Request v·ªõi session
    Flask->>Session: Ki·ªÉm tra session['user_id']
    
    alt Session exists
        Session-->>Flask: Valid user_id
        Flask-->>Browser: Cho ph√©p truy c·∫≠p
    else No session
        Session-->>Flask: No user_id
        Flask-->>Browser: Redirect to /login
        Browser->>User: Hi·ªÉn th·ªã login form
        User->>Browser: Submit credentials
        Browser->>Flask: POST /login
        Flask->>Database: Verify user
        alt Valid credentials
            Database-->>Flask: User data
            Flask->>Session: Set session['user_id']
            Flask-->>Browser: Redirect to dashboard
        else Invalid credentials
            Database-->>Flask: No match
            Flask-->>Browser: Login failed message
        end
    end
```

### üîí Route Protection Pattern

```mermaid
graph LR
    REQUEST[HTTP Request] --> CHECK{@login_required?}
    CHECK -->|Yes| SESSION{Session exists?}
    CHECK -->|No| ALLOW[Allow Access]
    
    SESSION -->|Yes| ROUTE[Execute Route]
    SESSION -->|No| LOGIN[Redirect to Login]
    
    ROUTE --> RESPONSE[Return Response]
    LOGIN --> AUTH_PAGE[Login Page]
    
    style SESSION fill:#fff3e0
    style LOGIN fill:#ffebee
    style ROUTE fill:#e8f5e8
```

---

## ü§ñ Face Recognition Pipeline

### üé• Real-time Recognition Flow

```mermaid
flowchart TD
    START([B·∫Øt ƒë·∫ßu ƒêi·ªÉm danh]) --> INIT[Kh·ªüi t·∫°o Camera]
    INIT --> MODEL{Ch·ªçn Model}
    
    MODEL -->|OpenCV| OPENCV[OpenCV Haar Cascade]
    MODEL -->|Face Recognition| FACEREC[face_recognition Library]
    MODEL -->|Advanced| ADVANCED[Custom Deep Learning]
    
    OPENCV --> CAPTURE[Capture Frame]
    FACEREC --> CAPTURE
    ADVANCED --> CAPTURE
    
    CAPTURE --> DETECT[Detect Faces]
    DETECT --> FOUND{Faces Found?}
    
    FOUND -->|No| CAPTURE
    FOUND -->|Yes| ENCODE[Encode Face Features]
    
    ENCODE --> COMPARE[So s√°nh v·ªõi Database]
    COMPARE --> MATCH{Match Found?}
    
    MATCH -->|Yes| IDENTIFY[X√°c ƒë·ªãnh Sinh vi√™n]
    MATCH -->|No| UNKNOWN[Unknown Face]
    
    IDENTIFY --> RECORD[Ghi nh·∫≠n ƒêi·ªÉm danh]
    UNKNOWN --> CAPTURE
    RECORD --> DISPLAY[Hi·ªÉn th·ªã K·∫øt qu·∫£]
    DISPLAY --> CONTINUE{Ti·∫øp t·ª•c?}
    
    CONTINUE -->|Yes| CAPTURE
    CONTINUE -->|No| END([K·∫øt th√∫c])
    
    style DETECT fill:#e1f5fe
    style IDENTIFY fill:#e8f5e8
    style RECORD fill:#fff3e0
```

### üß† AI Model Comparison

```mermaid
graph TD
    subgraph "OpenCV Model"
        OCV_SPEED[‚ö° T·ªëc ƒë·ªô: R·∫•t nhanh]
        OCV_ACC[üéØ ƒê·ªô ch√≠nh x√°c: Trung b√¨nh]
        OCV_RES[üíæ T√†i nguy√™n: √çt]
    end
    
    subgraph "Face Recognition Model"
        FR_SPEED[‚ö° T·ªëc ƒë·ªô: Trung b√¨nh]
        FR_ACC[üéØ ƒê·ªô ch√≠nh x√°c: Cao]
        FR_RES[üíæ T√†i nguy√™n: V·ª´a]
    end
    
    subgraph "Advanced AI Model"
        ADV_SPEED[‚ö° T·ªëc ƒë·ªô: Ch·∫≠m]
        ADV_ACC[üéØ ƒê·ªô ch√≠nh x√°c: R·∫•t cao]
        ADV_RES[üíæ T√†i nguy√™n: Nhi·ªÅu]
    end
    
    USECASE[L·ª±a ch·ªçn theo Use Case] --> OCV_SPEED
    USECASE --> FR_ACC
    USECASE --> ADV_ACC
    
    style OCV_SPEED fill:#ffcdd2
    style FR_ACC fill:#fff9c4
    style ADV_ACC fill:#c8e6c9
```

---

## üóÑÔ∏è Database Flow

### üìä Database Schema Relationships

```mermaid
erDiagram
    USERS ||--o{ CLASSES : creates
    CLASSES ||--o{ STUDENTS : contains
    CLASSES ||--o{ SUBJECTS : has
    SUBJECTS ||--o{ ATTENDANCE_SESSIONS : includes
    STUDENTS ||--o{ ATTENDANCE_RECORDS : participates
    ATTENDANCE_SESSIONS ||--o{ ATTENDANCE_RECORDS : records
    
    USERS {
        int id PK
        string username
        string password_hash
        datetime created_at
    }
    
    CLASSES {
        int id PK
        string name
        string description
        int user_id FK
        datetime created_at
    }
    
    STUDENTS {
        int id PK
        string student_id
        string full_name
        string email
        int class_id FK
        datetime created_at
    }
    
    SUBJECTS {
        int id PK
        string name
        string description
        int class_id FK
        datetime created_at
    }
    
    ATTENDANCE_SESSIONS {
        int id PK
        string session_name
        int subject_id FK
        datetime created_at
        string status
    }
    
    ATTENDANCE_RECORDS {
        int id PK
        int student_id FK
        int session_id FK
        datetime timestamp
        string status
    }
```

### üíæ Data Processing Flow

```mermaid
sequenceDiagram
    participant UI as Web Interface
    participant Route as Flask Route
    participant DB as Database
    participant AI as AI Module
    participant Storage as File Storage
    
    Note over UI,Storage: Quy tr√¨nh Thu th·∫≠p D·ªØ li·ªáu Khu√¥n m·∫∑t
    
    UI->>Route: Ch·ªçn sinh vi√™n
    Route->>DB: L·∫•y th√¥ng tin sinh vi√™n
    DB-->>Route: Student data
    Route-->>UI: Hi·ªÉn th·ªã camera
    
    UI->>AI: Capture face images
    AI->>AI: Augmentation (rotation, brightness)
    AI->>Storage: L∆∞u ·∫£nh g·ªëc + augmented
    AI-->>UI: Feedback qu√° tr√¨nh
    
    UI->>Route: Ho√†n th√†nh thu th·∫≠p
    Route->>AI: Train/Update model
    AI->>Storage: L∆∞u model m·ªõi
    AI-->>Route: Training complete
    Route-->>UI: Th√¥ng b√°o th√†nh c√¥ng
```

---

## üìà Performance Metrics

### ‚ö° Response Time Analysis

```mermaid
graph LR
    subgraph "Performance Benchmarks"
        LOGIN[Login: ~200ms]
        DASHBOARD[Dashboard: ~300ms]
        FACE_DETECT[Face Detection: ~100ms]
        RECOGNITION[Recognition: ~500ms]
        EXPORT[Excel Export: ~2s]
    end
    
    subgraph "Optimization Targets"
        OPT1[Database queries < 100ms]
        OPT2[Face recognition < 300ms]
        OPT3[File operations < 1s]
    end
    
    LOGIN --> OPT1
    FACE_DETECT --> OPT2
    EXPORT --> OPT3
    
    style LOGIN fill:#c8e6c9
    style FACE_DETECT fill:#fff9c4
    style EXPORT fill:#ffcdd2
```

### üîç Accuracy Metrics

| Model | Speed | Accuracy | Resource Usage | Best Use Case |
|-------|-------|----------|----------------|---------------|
| OpenCV | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | Demo, Testing |
| Face Recognition | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Production |
| Advanced AI | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | High Security |

---

## üö® Error Handling

### üõ†Ô∏è Troubleshooting Flowchart

```mermaid
flowchart TD
    ERROR[L·ªói x·∫£y ra] --> TYPE{Lo·∫°i l·ªói?}
    
    TYPE -->|Camera| CAM_ERROR[Camera kh√¥ng ho·∫°t ƒë·ªông]
    TYPE -->|Recognition| AI_ERROR[AI kh√¥ng nh·∫≠n di·ªán]
    TYPE -->|Database| DB_ERROR[Database l·ªói]
    TYPE -->|File| FILE_ERROR[File kh√¥ng t·∫£i ƒë∆∞·ª£c]
    
    CAM_ERROR --> CAM_CHECK{Camera connected?}
    CAM_CHECK -->|No| CAM_FIX[K·∫øt n·ªëi camera]
    CAM_CHECK -->|Yes| CAM_PERM[Ki·ªÉm tra quy·ªÅn camera]
    
    AI_ERROR --> MODEL_CHECK{Model loaded?}
    MODEL_CHECK -->|No| LOAD_MODEL[Load l·∫°i model]
    MODEL_CHECK -->|Yes| RETRAIN[C·∫ßn train l·∫°i?]
    
    DB_ERROR --> DB_CHECK{Database exists?}
    DB_CHECK -->|No| CREATE_DB[T·∫°o database m·ªõi]
    DB_CHECK -->|Yes| DB_REPAIR[S·ª≠a database]
    
    FILE_ERROR --> PERM_CHECK{Quy·ªÅn ghi file?}
    PERM_CHECK -->|No| FIX_PERM[S·ª≠a quy·ªÅn th∆∞ m·ª•c]
    PERM_CHECK -->|Yes| DISK_SPACE[Ki·ªÉm tra dung l∆∞·ª£ng]
    
    style ERROR fill:#ffcdd2
    style CAM_FIX fill:#c8e6c9
    style LOAD_MODEL fill:#c8e6c9
    style CREATE_DB fill:#c8e6c9
```

### üîß Common Issues & Solutions

```mermaid
graph TD
    subgraph "Camera Issues"
        C1[Camera kh√¥ng b·∫≠t ƒë∆∞·ª£c]
        C2[H√¨nh ·∫£nh b·ªã m·ªù]
        C3[FPS qu√° th·∫•p]
    end
    
    subgraph "AI Issues"
        A1[Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c]
        A2[Nh·∫≠n di·ªán sai ng∆∞·ªùi]
        A3[Model load ch·∫≠m]
    end
    
    subgraph "Solutions"
        S1[Ki·ªÉm tra driver camera]
        S2[ƒêi·ªÅu ch·ªânh √°nh s√°ng]
        S3[Gi·∫£m resolution]
        S4[Thu th·∫≠p th√™m d·ªØ li·ªáu]
        S5[Train l·∫°i model]
        S6[T·ªëi ∆∞u model size]
    end
    
    C1 --> S1
    C2 --> S2
    C3 --> S3
    A1 --> S4
    A2 --> S5
    A3 --> S6
    
    style C1 fill:#ffcdd2
    style A1 fill:#ffcdd2
    style S1 fill:#c8e6c9
    style S4 fill:#c8e6c9
```

### üìã Troubleshooting Guide

| L·ªói | Tri·ªáu ch·ª©ng | Nguy√™n nh√¢n | Gi·∫£i ph√°p |
|-----|-------------|-------------|-----------|
| üì∑ **Camera kh√¥ng ho·∫°t ƒë·ªông** | M√†n h√¨nh ƒëen, kh√¥ng c√≥ video | Browser ch∆∞a c·∫•p quy·ªÅn | V√†o Settings ‚Üí Privacy ‚Üí Camera ‚Üí Allow |
| üß† **Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c** | "Kh√¥ng t√¨m th·∫•y sinh vi√™n" | Ch∆∞a thu th·∫≠p ƒë·ªß d·ªØ li·ªáu | Thu th·∫≠p th√™m 10-15 ·∫£nh khu√¥n m·∫∑t |
| üìä **Xu·∫•t Excel l·ªói** | File kh√¥ng t·∫£i v·ªÅ | L·ªói permissions | T·∫°o th∆∞ m·ª•c `exports` v·ªõi quy·ªÅn write |
| üóÑÔ∏è **Database locked** | "Database is locked" | Nhi·ªÅu connections | Restart server, ƒë√≥ng t·∫•t c·∫£ connections |
| üåê **Server kh√¥ng ph·∫£n h·ªìi** | Trang tr·∫Øng/timeout | Server crash | Restart b·∫±ng `python app.py` |

---

## üìä System Monitoring

### üìà Real-time Dashboard Metrics

```mermaid
graph LR
    subgraph "System Health"
        CPU[CPU Usage]
        RAM[Memory Usage]
        DISK[Disk Space]
        CAM[Camera Status]
    end
    
    subgraph "Application Metrics"
        USERS[Active Users]
        SESSIONS[Active Sessions]
        ACCURACY[Recognition Accuracy]
        SPEED[Processing Speed]
    end
    
    subgraph "Alerts"
        HIGH_CPU[CPU > 80%]
        LOW_DISK[Disk < 10%]
        CAM_FAIL[Camera Offline]
        LOW_ACC[Accuracy < 90%]
    end
    
    CPU --> HIGH_CPU
    DISK --> LOW_DISK
    CAM --> CAM_FAIL
    ACCURACY --> LOW_ACC
    
    style HIGH_CPU fill:#ffcdd2
    style LOW_DISK fill:#ffcdd2
    style CAM_FAIL fill:#ffcdd2
    style LOW_ACC fill:#fff9c4
```

### ‚è±Ô∏è Performance Timeline

```mermaid
gantt
    title Th·ªùi gian x·ª≠ l√Ω c√°c t√°c v·ª• h·ªá th·ªëng
    dateFormat X
    axisFormat %L ms
    
    section Authentication
    Login process: 0, 200
    Session check: 0, 50
    
    section Face Recognition
    Camera init: 0, 300
    Face detection: 0, 100
    Face recognition: 0, 500
    
    section Data Operations
    Database query: 0, 50
    Excel export: 0, 2000
    Model training: 0, 10000
```

---

## üéØ Conclusion

H·ªá th·ªëng ƒëi·ªÉm danh khu√¥n m·∫∑t ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi ki·∫øn tr√∫c modular, d·ªÖ b·∫£o tr√¨ v√† m·ªü r·ªông. Lu·ªìng ho·∫°t ƒë·ªông ƒë∆∞·ª£c t·ªëi ∆∞u ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t cao v√† tr·∫£i nghi·ªám ng∆∞·ªùi d√πng m∆∞·ª£t m√†.

### üîë Key Benefits

1. **üöÄ High Performance**: X·ª≠ l√Ω real-time v·ªõi multiple AI models
2. **üîí Secure**: Session-based authentication v·ªõi route protection
3. **üì± Responsive**: Mobile-friendly interface
4. **üìä Analytics**: Comprehensive reporting v√† export capabilities
5. **üõ†Ô∏è Maintainable**: Clean code structure v·ªõi detailed documentation

### üéØ Future Enhancements

- [ ] API REST cho mobile app
- [ ] Cloud deployment support
- [ ] Advanced analytics dashboard
- [ ] Multi-tenant support
- [ ] Real-time notifications
- [ ] Integration v·ªõi h·ªá th·ªëng LMS

---

*üìù Document ƒë∆∞·ª£c c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n ƒë·ªÉ ph·∫£n √°nh c√°c thay ƒë·ªïi trong h·ªá th·ªëng.*
